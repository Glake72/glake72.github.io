<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Page web</title>
<style>
Â Â Â  body {
Â Â Â Â Â Â Â  margin: 0;
Â Â Â Â Â Â Â  font-family: Arial, sans-serif;
Â Â Â Â Â Â Â  min-height: 100vh;
Â Â Â Â Â Â Â  display: flex;
Â Â Â Â Â Â Â  flex-direction: column;
Â Â Â Â Â Â Â  background-color: white;
Â Â Â Â Â Â Â  color: #000;
Â Â Â Â Â Â Â  animation: fondAnime 10s ease-in-out infinite;
Â Â Â  }
Â Â Â  .roman {
Â Â Â Â Â Â Â  text-align: center;
Â Â Â Â Â Â Â  border-radius: 30px;
Â Â Â Â Â Â Â  margin: 20px auto;
Â Â Â Â Â Â Â  max-width: 500px;
Â Â Â Â Â Â Â  background: #b8daf9;
Â Â Â Â Â Â Â  font-weight: bold;
Â Â Â Â Â Â Â  font-size: 0.7em;
Â Â Â Â Â Â Â  box-shadow: 0 2px 8px rgba(0,0,0,0.07);
Â Â Â  }
Â Â Â  .contenu {
Â Â Â Â Â Â Â  flex: 1;
Â Â Â Â Â Â Â  padding: 30px;
Â Â Â  }
Â Â Â  h1, h2 {
Â Â Â Â Â Â Â  text-align: center;
Â Â Â Â Â Â Â  border: 2px solid #00ff1a;
Â Â Â Â Â Â Â  border-radius: 30px;
Â Â Â Â Â Â Â  padding: 10px;
Â Â Â Â Â Â Â  margin: 20px auto;
Â Â Â Â Â Â Â  max-width: 600px;
Â Â Â  }
Â Â Â  .banniere-bas {
Â Â Â Â Â Â Â  width: 100%;
Â Â Â Â Â Â Â  background: #00ff15;
Â Â Â Â Â Â Â  color: rgb(197, 6, 6);
Â Â Â Â Â Â Â  display: flex;
Â Â Â Â Â Â Â  justify-content: center;
Â Â Â Â Â Â Â  align-items: center;
Â Â Â Â Â Â Â  padding: 15px 0;
Â Â Â Â Â Â Â  position: fixed;
Â Â Â Â Â Â Â  left: 0;
Â Â Â Â Â Â Â  bottom: 0;
Â Â Â  }
Â Â Â  .banniere-bas button {
Â Â Â Â Â Â Â  background: #00ff15;
Â Â Â Â Â Â Â  color: #000000;
Â Â Â Â Â Â Â  border: none;
Â Â Â Â Â Â Â  border-radius: 20px;
Â Â Â Â Â Â Â  margin: 0 10px;
Â Â Â Â Â Â Â  padding: 10px 20px;
Â Â Â Â Â Â Â  font-size: 1em;
Â Â Â Â Â Â Â  cursor: pointer;
Â Â Â Â Â Â Â  transition: background 0.2s, color 0.2s;
Â Â Â  }
Â Â Â  .banniere-bas button:hover {
Â Â Â Â Â Â Â  background: #000000;
Â Â Â Â Â Â Â  color: rgb(255, 255, 255);
Â Â Â  }
</style>

<script src="https://accounts.google.com/gsi/client" async defer></script>

<script src="https://apis.google.com/js/api.js" async defer></script>
</head>
<body>
<div class="contenu">
Â Â Â  <h1>Mon site</h1>
Â Â Â  <div class="roman">
Â Â Â Â Â Â Â  <h2>Fait par Roman SOUCY</h2>
Â Â Â  </div>
Â Â Â  <p style="text-align: center; max-width: 700px; margin: 30px auto;">
Â Â Â Â Â Â Â  Bienvenue sur cette page d'exemple rÃ©alisÃ©e en HTML, CSS et JAVASCRIPT. Vous pouvez y retrouver un moyen de sauvegarde de fichier(limitÃ© a 5 MO), des liens utiles, et une banniÃ¨re en bas de page pour accÃ©der rapidement aux sites web importants.
Â Â Â  </p>

Â Â Â  <div class="banniere-bas">
Â Â Â Â Â Â Â  <button onclick="window.location.href='mailto:roman.soucy@collegedesmuriers.fr'">Contacts</button>
Â Â Â Â Â Â Â  <button onclick="alert('Support non disponible pour le moment. Encore en dÃ©velopement ðŸ˜… ')">Support</button>
Â Â Â Â Â Â Â  <button onclick="window.location.href='https://www.ecoledirecte.com/login?cameFrom=%2FAccueil'">Ecole Direct</button>
Â Â Â Â Â Â Â  <button onclick="window.location.href='https://www.google.com'">Google</button>
Â Â Â Â Â Â Â  <button onclick="window.location.href='https://www.lri.fr/~jacquot/progWeb/cours4/cours4.pdf'">Informations</button>
Â Â Â  </div>

Â Â Â  <div class="bouton-ajout-image" style="text-align:center; margin: 30px 0;">
Â Â Â Â Â Â Â  <label for="file-upload" style="display:inline-block; background:#00ff15; color:#000; border-radius:20px; padding:10px 20px; cursor:pointer; font-size:1em;">
Â Â Â Â Â Â Â Â Â Â Â  Importer un fichier
Â Â Â Â Â Â Â Â Â Â Â  <input id="file-upload" type="file" multiple style="display:none;">
Â Â Â Â Â Â Â  </label>
Â Â Â  </div>
Â Â Â  <div id="preview-container" style="display:flex; flex-wrap:wrap; gap:16px; justify-content:center; margin-bottom:40px;"></div>

Â Â Â  <div style="text-align:center; margin:20px;">
Â Â Â Â Â Â Â  <button id="google-login-btn" style="background:#4285F4;color:#fff;border:none;border-radius:20px;padding:10px 20px;cursor:pointer;font-size:1em;">
Â Â Â Â Â Â Â Â Â Â Â  Connexion Google
Â Â Â Â Â Â Â  </button>
Â Â Â Â Â Â Â  <span id="google-user" style="margin-left:10px;"></span>
Â Â Â  </div>
</div>

<script>
const previewContainer = document.getElementById('preview-container');

// Tes identifiants Google. Garde-les secrets en production !
const CLIENT_ID = '716108448607-4d46lrnamcdkk07jo2gaq7bc9pu47ag3.apps.googleusercontent.com';
const API_KEY = 'AIzaSyBeHW_Izkd7InzeahDl6gGxI5OMyOhiFm8'; // L'API Key est pour les requÃªtes non-authentifiÃ©es ou le 'discovery' des APIs
const SCOPES = 'https://www.googleapis.com/auth/drive.file'; // Permet d'accÃ©der aux fichiers crÃ©Ã©s par l'app

let tokenClient; // UtilisÃ© par Google Identity Services (GIS) pour la connexion
let accessToken = null; // Le token d'accÃ¨s obtenu aprÃ¨s connexion

// Fonction appelÃ©e quand la bibliothÃ¨que GAPI (Google API Client) est chargÃ©e
function gapiLoaded() {
    gapi.load('client', initializeGapiClient);
}

// Initialise le client GAPI pour pouvoir faire des requÃªtes aux APIs (ex: Drive)
async function initializeGapiClient() {
    await gapi.client.init({
        apiKey: API_KEY, // API Key pour l'initialisation du client
        discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],
    });
    console.log('Google API client chargÃ©.'); // Pour dÃ©bogage
}

// Fonction appelÃ©e quand la bibliothÃ¨que GIS (Google Identity Services) est chargÃ©e
function gisLoaded() {
    tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        // Callback exÃ©cutÃ© aprÃ¨s que l'utilisateur se soit connectÃ© ou ait donnÃ© son consentement
        callback: (tokenResponse) => {
            if (tokenResponse.error) {
                // GÃ¨re les erreurs de connexion/consentement
                alert('Erreur de connexion Google : ' + tokenResponse.error);
                console.error('Erreur GIS:', tokenResponse.error);
                return;
            }
            // Si la connexion rÃ©ussit, stocke le token d'accÃ¨s
            accessToken = tokenResponse.access_token;
            document.getElementById('google-user').textContent = "ConnectÃ©";
            console.log('ConnectÃ© Ã  Google, token d\'accÃ¨s obtenu.'); // Pour dÃ©bogage
            // Tu peux charger les donnÃ©es utilisateur ici si tu veux, par exemple:
            // gapi.client.setToken({ access_token: accessToken });
            // gapi.client.oauth2.userinfo.get().then(response => {
            //     console.log('User Info:', response.result);
            //     document.getElementById('google-user').textContent = "ConnectÃ© en tant que " + response.result.name;
            // });
        },
    });
}

// Assure que les fonctions sont accessibles globalement par les scripts async (defer)
window.gapiLoaded = gapiLoaded;
window.gisLoaded = gisLoaded;

// GÃ¨re le clic sur le bouton de connexion Google
document.getElementById('google-login-btn').onclick = () => {
    // VÃ©rifie si le client de token a Ã©tÃ© initialisÃ©
    if (!tokenClient) {
        alert("La bibliothÃ¨que de connexion Google n'est pas encore chargÃ©e. Veuillez rÃ©essayer dans quelques secondes.");
        return;
    }
    // Demande le token d'accÃ¨s. Cela ouvre la pop-up de connexion/consentement de Google.
    tokenClient.requestAccessToken();
};

// --- GESTION DES FICHIERS ET UPLOAD SUR DRIVE ---

// Convertit une dataURL en Blob pour l'upload
function dataURLtoBlob(dataurl) {
    var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],
        bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
    while(n--) u8arr[n] = bstr.charCodeAt(n);
    return new Blob([u8arr], {type:mime});
}

// Upload un fichier sur Google Drive
async function uploadToDrive(fileName, dataURL, fileType) {
    // VÃ©rifie si l'utilisateur est connectÃ©
    if (!accessToken) {
        alert("Connectez-vous Ã  Google avant d'envoyer sur Drive.");
        return;
    }
    // VÃ©rifie si l'API Drive est chargÃ©e
    if (!gapi.client.drive) {
        alert("L'API Google Drive n'est pas encore chargÃ©e. Veuillez patienter ou rÃ©essayer.");
        return;
    }

    const fileBlob = dataURLtoBlob(dataURL);
    const metadata = {
        name: fileName,
        mimeType: fileType
    };

    const form = new FormData();
    form.append('metadata', new Blob([JSON.stringify(metadata)], {type: 'application/json'}));
    form.append('file', fileBlob);

    try {
        // Envoie la requÃªte Ã  l'API Google Drive via gapi.client
        const res = await gapi.client.request({
            path: 'https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id',
            method: 'POST',
            headers: {
                'Authorization': 'Bearer ' + accessToken, // Utilise le token d'accÃ¨s pour l'authentification
                'Content-Type': 'multipart/related' // Important pour les uploads de fichiers
            },
            body: form, // Le corps de la requÃªte est le FormData
        });
        alert('Fichier envoyÃ© sur Google Drive ! ID: ' + res.result.id);
        console.log('Fichier uploadÃ©:', res.result);
    } catch (err) {
        console.error('Erreur lors de l\'envoi sur Drive:', err);
        // Affiche un message d'erreur plus dÃ©taillÃ© si disponible
        alert('Erreur lors de l\'envoi sur Drive: ' + (err.result && err.result.error ? err.result.error.message : err.message || "Erreur inconnue."));
    }
}

// CrÃ©e la boÃ®te de prÃ©visualisation pour un fichier
function createPreviewBox(fileName, dataURL, fileType) {
Â Â Â  const previewBox = document.createElement('div');
Â Â Â  previewBox.style.border = '2px solid #00ff15';
Â Â Â  previewBox.style.borderRadius = '15px';
Â Â Â  previewBox.style.padding = '10px';
Â Â Â  previewBox.style.background = '#f0f0f0';
Â Â Â  previewBox.style.position = 'relative';
Â Â Â  previewBox.style.width = '150px';
Â Â Â  previewBox.style.textAlign = 'center';

Â Â Â  let content;
Â Â Â  if (fileType.startsWith('image/')) {
Â Â Â Â Â Â Â  content = document.createElement('img');
Â Â Â Â Â Â Â  content.src = dataURL;
Â Â Â Â Â Â Â  content.style.maxWidth = '100%';
Â Â Â Â Â Â Â  content.style.maxHeight = '100px';
Â Â Â Â Â Â Â  content.alt = fileName;
Â Â Â  } else {
Â Â Â Â Â Â Â  content = document.createElement('div');
Â Â Â Â Â Â Â  content.textContent = fileName;
Â Â Â Â Â Â Â  content.style.margin = '20px 0';
Â Â Â  }
Â Â Â  previewBox.appendChild(content);

Â Â Â  // TÃ©lÃ©charger bouton
Â Â Â  const downloadBtn = document.createElement('a');
Â Â Â  downloadBtn.textContent = 'TÃ©lÃ©charger';
Â Â Â  downloadBtn.href = dataURL;
Â Â Â  downloadBtn.download = fileName;
Â Â Â  downloadBtn.style.position = 'absolute';
Â Â Â  downloadBtn.style.left = '5px';
Â Â Â  downloadBtn.style.top = '5px';
Â Â Â  downloadBtn.style.background = '#00ff15';
Â Â Â  downloadBtn.style.color = '#000';
Â Â Â  downloadBtn.style.border = 'none';
Â Â Â  downloadBtn.style.borderRadius = '10px';
Â Â Â  downloadBtn.style.padding = '5px 10px';
Â Â Â  downloadBtn.style.textDecoration = 'none';
Â Â Â  downloadBtn.style.cursor = 'pointer';
Â Â Â  previewBox.appendChild(downloadBtn);

Â Â Â  // Enregistrer sur Drive bouton
Â Â Â  const driveBtn = document.createElement('button');
Â Â Â  driveBtn.textContent = 'Enregistrer sur Drive';
Â Â Â  driveBtn.style.position = 'absolute';
Â Â Â  driveBtn.style.top = '35px';
Â Â Â  driveBtn.style.left = '5px';
Â Â Â  driveBtn.style.background = '#4285F4';
Â Â Â  driveBtn.style.color = '#fff';
Â Â Â  driveBtn.style.border = 'none';
Â Â Â  driveBtn.style.borderRadius = '10px';
Â Â Â  driveBtn.style.padding = '5px 10px';
Â Â Â  driveBtn.style.cursor = 'pointer';
Â Â Â  driveBtn.onclick = function() {
Â Â Â Â Â Â Â  uploadToDrive(fileName, dataURL, fileType);
Â Â Â  };
Â Â Â  previewBox.appendChild(driveBtn);

Â Â Â  // Supprimer bouton
Â Â Â  const removeBtn = document.createElement('button');
Â Â Â  removeBtn.textContent = 'Supprimer';
Â Â Â  removeBtn.style.position = 'absolute';
Â Â Â  removeBtn.style.top = '90px';
Â Â Â  removeBtn.style.right = '5px';
Â Â Â  removeBtn.style.background = '#ff4d4d';
Â Â Â  removeBtn.style.color = '#fff';
Â Â Â  removeBtn.style.border = 'none';
Â Â Â  removeBtn.style.borderRadius = '10px';
Â Â Â  removeBtn.style.padding = '5px 10px';
Â Â Â  removeBtn.style.cursor = 'pointer';
Â Â Â  removeBtn.onclick = function() {
Â Â Â Â Â Â Â  previewBox.remove();
Â Â Â Â Â Â Â  // Supprimer du localStorage
Â Â Â Â Â Â Â  let saved = JSON.parse(localStorage.getItem('fichiers') || '[]');
Â Â Â Â Â Â Â  saved = saved.filter(f => f.name !== fileName);
Â Â Â Â Â Â Â  localStorage.setItem('fichiers', JSON.stringify(saved));
Â Â Â  };
Â Â Â  previewBox.appendChild(removeBtn);

Â Â Â  previewContainer.appendChild(previewBox);
}

// Ajouter et sauvegarder fichiers depuis l'input
document.getElementById('file-upload').addEventListener('change', function(event) {
Â Â Â  const files = Array.from(event.target.files);
Â Â Â  let saved = JSON.parse(localStorage.getItem('fichiers') || '[]');

Â Â Â  files.forEach((file) => {
Â Â Â Â Â Â Â  const reader = new FileReader();
Â Â Â Â Â Â Â  reader.onload = function(e) {
Â Â Â Â Â Â Â Â Â Â Â  createPreviewBox(file.name, e.target.result, file.type);
Â Â Â Â Â Â Â Â Â Â Â  saved.push({ name: file.name, data: e.target.result, type: file.type });
Â Â Â Â Â Â Â Â Â Â Â  localStorage.setItem('fichiers', JSON.stringify(saved));
Â Â Â Â Â Â Â  };
Â Â Â Â Â Â Â  reader.readAsDataURL(file);
Â Â Â  });
});

// Le chargement initial des fichiers sauvegardÃ©s depuis localStorage.
// Les scripts GAPI et GIS sont dÃ©jÃ  chargÃ©s dans le <head> avec `async defer`,
// ce qui est la mÃ©thode recommandÃ©e. Le bloc ci-dessous n'est donc plus nÃ©cessaire
// car les fonctions `gapiLoaded` et `gisLoaded` seront appelÃ©es par les scripts eux-mÃªmes.
/*
window.addEventListener('DOMContentLoaded', () => {
Â Â Â  // Load Google APIs dynamically (redundant but sure) - C'est redondant avec les scripts dans le head
Â Â Â  const scriptGapi = document.createElement('script');
Â Â Â  scriptGapi.src = "https://apis.google.com/js/api.js";
Â Â Â  scriptGapi.onload = gapiLoaded;
Â Â Â  document.head.appendChild(scriptGapi);

Â Â Â  const scriptGis = document.createElement('script');
Â Â Â  scriptGis.src = "https://accounts.google.com/gsi/client";
Â Â Â  scriptGis.onload = gisLoaded;
Â Â Â  document.head.appendChild(scriptGis);

Â Â Â  const saved = JSON.parse(localStorage.getItem('fichiers') || '[]');
Â Â Â  saved.forEach(f => createPreviewBox(f.name, f.data, f.type));
});
*/

// On garde le chargement des fichiers sauvegardÃ©s mais en dehors du DOMContentLoaded pour Ã©viter la confusion
const saved = JSON.parse(localStorage.getItem('fichiers') || '[]');
saved.forEach(f => createPreviewBox(f.name, f.data, f.type));


</script>
<script src="Animation.js"></script>
</body>
</html>
